<link href="__PUBLIC__/static/css/main.css" rel="stylesheet" type="text/css">

<div class="flexigrid">
    <div class="mDiv">
        <div class="ftitle">
            <h3>{$title}</h3>
        </div>
    </div>
    <div class="tDiv2">
        <div class="fbutton">
            <!--<button onclick="addUser();" class="btnGray addUser">增加用户</button>-->
            <form action="{:U(GROUP_NAME.'/User/index')}" method="post" style="margin-top: -6px;">
                <input name="keyword" type="text" class="qsbox" id="input-order-id" placeholder="手机号搜索" value="{$keyword}" size="20"/>
                <input name="submit" class="btn margin_lf" type="submit" value="筛选"/>
                <span style="color:red;font-size:15px;margin-left:20px;">提示：未绑定为自己的用户不在此显示，请先到用户池绑定属于自己的用户。</span>
            </form>
        </div>
    </div>
    <div class="hDiv">
        <div class="hDivBox">
            <table cellspacing="0" cellpadding="0">
                <thead>
                <tr style="background: #886f6f;color: white;">
                    <th align="left" abbr="article_title" axis="col3" class="">
                        <div style="text-align: center; width: 100px;" class="">ID</div>
                    </th>
                    <th align="left" abbr="article_title" axis="col3" class="">
                        <div style="text-align: center; width: 100px;" class="">客户手机</div>
                    </th>
                    <th align="left" abbr="ac_id" axis="col4" class="">
                        <div style="text-align: center; width: 100px;" class="">客户名</div>
                    </th>
                    <th align="center" abbr="article_time" axis="col6" class="">
                        <div style="text-align: center; width: 100px;" class="">状态</div>
                    </th>
                    <th align="center" abbr="article_show" axis="col5" class="">
                        <div style="text-align: center; width: 100px;" class="">注册时间</div>
                    </th>

                    <th align="center" axis="col1" class="handle">
                        操作
                    </th>
                    <th style="width:100%; text-align: center;" axis="col7">
                        <div></div>
                    </th>
                </tr>

                </thead>
            </table>
        </div>
    </div>
    <div class="bDiv" style="height: auto;">
        <div id="flexigrid" cellpadding="0" cellspacing="0" border="0">
            <table>
                <tbody>
                <volist name="list" id="vo">
                    <tr>
                        <td align="center">
                            <div style="text-align: center; width: 100px;" class="">{$vo.id}</div>
                        </td>
                        <td align="center">
                            <div style="text-align: center; width: 100px;" class="">{$vo.phone}</div>
                        </td>
                        <td align="center">
                            <div style="text-align: center; width: 100px;" class="">{$data[$vo['phone']]}</div>
                        </td>
                        <td align="center">
                            <div style="text-align: center; width: 100px;" class="">
                                <php>
                                    if($vo['status'] == 1) echo "允许登录";
                                    if($vo['status'] == 0) echo "禁止登录";
                                </php>
                            </div>
                        </td>
                        <td align="center">
                            <div style="text-align: center; width: 100px;" class="">{$vo.addtime|date="Y/m/d",###}</div>
                        </td>


                        <td align="center" class="handle" style="width: 100%;">
                            <div style="text-align: center; width: 100px;">

                                <php>
                                    if($vo['status'] == 1){
                                </php>
                                <a href="{:U(GROUP_NAME.'/User/status',array('id' => $vo['id']))}"
                                   class="btn blue">禁止登录</a>
                                <php>
                                    }else{
                                </php>
                                <a href="{:U(GROUP_NAME.'/User/status',array('id' => $vo['id']))}"
                                   class="btn blue">允许登录</a>
                                <php>
                                    }
                                </php>
                                <a href="{:U(GROUP_NAME.'/User/userinfo',array('user' => $vo['phone']))}"
                                   class="btn blue"><i class="fa fa-list-alt"></i>查看资料</a>
                                <a href="javascript:changePass('{$vo.id}');" class="btn blue"><i
                                        class="fa fa-pencil-square-o"></i>修改密码</a>
                                <a href="javascript:changeuser('{$vo.id}');" class="btn blue"><i
                                        class="fa fa-pencil-square-o"></i>修改用户</a>
                                <a class="btn red" href="javascript:del('{$vo.phone}','{:U(GROUP_NAME.'/User/del',array('id'=>$vo['id']))}');"><i class="fa fa-trash-o"></i>删除</a>
                            </div>
                        </td>
                    </tr>
                </volist>
                </tbody>
            </table>
        </div>
    </div>
</div>
<div class="clear"></div>
<div class="pages">{$page}</div>

<style>
    .addUser {
        margin-left: 20px;
        background: red;
        color: #fff;
    }
    body{
         overflow-y:scroll;
         overflow-x:scroll;
     }
</style>
<script>
    //增加用户
    function addUser() {

        layer.prompt({title: '增加用户', formType: 0}, function (pass, index) {
            if (pass == '' || pass == null) {
                layer.msg('用户名不能为空!');
            } else if (pass.length < 11) {
                layer.msg("用户名不能为空长度不能小于11位!");
            } else {
                $.post(
                    "/index.php?g=Admin&m=User&a=addUser",
                    {pass: pass},
                    function (data, state) {
                        if (state != "success") {
                            layer.msg("网络通讯失败!");
                        } else if (data.status == 1) {
                            layer.msg(data.msg);
                            layer.close(index);
                            location.href = window.location.href;
                        } else {
                            layer.msg(data.msg);
                        }
                    }
                );
            }
        });
    }

    function del(uname, jumpurl) {
        layer.confirm(
            '确定要删除用户:' + uname + '吗?',
            function () {
                window.location.href = jumpurl;
            }
        );
    }

    function changePass(uid) {
        layer.prompt({title: '输入新密码，并确认', formType: 1}, function (pass, index) {
            if (pass == '' || pass == null) {
                layer.msg('密码不能为空!');
            } else if (pass.length < 6) {
                layer.msg("密码长度不能小于6位!");
            } else {
                $.post(
                    "{:U(GROUP_NAME.'/Admin/changePass')}",
                    {id: uid, pass: pass},
                    function (data, state) {
                        if (state != "success") {
                            layer.msg("网络通讯失败!");
                        } else if (data.status == 1) {
                            layer.msg("密码修改成功!");
                            layer.close(index);
                        } else {
                            layer.msg(data.msg);
                        }
                    }
                );
            }
        });
    }

    function changeuser(uid) {
        layer.prompt({title: '输入用户手机号，并确认', formType: 0}, function (pass, index) {
            if (pass == '' || pass == null) {
                layer.msg('手机号不能为空!');
            } else if (pass.length < 11) {
                layer.msg("手机号长度不能小于11位!");
            } else {
                $.post(
                    "/index.php?g=Admin&m=User&a=changeuser",
                    {id: uid, pass: pass},
                    function (data, state) {
                        if (state != "success") {
                            layer.msg("网络通讯失败!");
                        } else if (data.status == 1) {
                            layer.msg("用户修改成功!");
                            layer.close(index);
                            location.href = window.location.href;
                        } else {
                            layer.msg(data.msg);
                        }
                    }
                );
            }
        });
    }
</script>