<link href="__PUBLIC__/static/css/main.css" rel="stylesheet" type="text/css">
<div class="flexigrid">
    <div class="mDiv">
        <div class="ftitle">
            <h3>{$title}</h3>
        </div>
    </div>
    <div class="tDiv">
        <div class="tDiv2">
            <div class="fbutton">
                <form action="{:U(GROUP_NAME.'/Daikuan/index')}" method="post">
                    <select name="status">
                        <option value="99">订单状态搜索</option>
                        <option value="-1"
                        <if condition="$status eq -1">selected</if>
                        >审核不通过</option>
                        <option value="-2"
                        <if condition="$status eq -2">selected</if>
                        >冻结</option>
                        <option value="2"
                        <if condition="$status eq 2">selected</if>
                        >审核通过</option>
                        <option value="3"
                        <if condition="$status eq 3">selected</if>
                        >提交成功</option>
                        <option value="4"
                        <if condition="$status eq 4">selected</if>
                        >首期</option>
                        <option value="5"
                        <if condition="$status eq 5">selected</if>
                        >退款中</option>
                        <option value="7"
                        <if condition="$status eq 7">selected</if>
                        >打款中</option>
                        <option value="8"
                        <if condition="$status eq 8">selected</if>
                        >绑卡失败</option>
                        <option value="9"
                        <if condition="$status eq 9">selected</if>
                        >正在审核</option>
                        <option value="11"
                        <if condition="$status eq 11">selected</if>
                        >提现处理</option>
                        <option value="12"
                        <if condition="$status eq 12">selected</if>
                        >到帐成功</option>
                        <option value="13"
                        <if condition="$status eq 13">selected</if>
                        >保险</option>
                        <option value="14"
                        <if condition="$status eq 14">selected</if>
                        >第一期还款</option>
                        <option value="15"
                        <if condition="$status eq 15">selected</if>
                        >提现失败</option>
                        <option value="17"
                        <if condition="$status eq 17">selected</if>
                        >征信不良</option>
                        <option value="18"
                        <if condition="$status eq 18">selected</if>
                        >核实失败</option>
                    </select>
                    <input name="ordernum" type="text" class="qsbox margin_lf" placeholder="订单号搜索" value="{$ordernum}"
                           size="20"/>
                    <input name="keyword" type="text" class="qsbox margin_lf" id="input-order-id" placeholder="手机号搜索"
                           value="{$keyword}" size="20"/>
                    <input name="start_time" id="start_time" autocomplete="off" type="text" class="qsbox margin_lf"
                           placeholder="开始时间"
                           value="{$start_time}"
                           size="20"/>
                    <input name="end_time" id="end_time" autocomplete="off" type="text" class="qsbox margin_lf"
                           placeholder="结束时间"
                           value="{$end_time}"
                           size="20"/>
                    <input name="submit" class="btn margin_lf" type="submit" value="筛选"/>
                </form>
            </div>
            <span style="color:red;font-size:15px;float: right">提示：未绑定为自己的用户不在此显示，请先到用户池绑定属于自己的用户。</span>
        </div>
        <div style="clear:both"></div>
    </div>
    <div class="hDiv">
        <div class="hDivBox">
            <table cellspacing="0" cellpadding="0">
                <thead>
                <tr style="background: #886f6f;color: white;">
                    <th align="left" abbr="article_title" axis="col3" class="">
                        <div style="text-align: center; width: 20px;" class="">ID</div>
                    </th>
                    <th align="left" abbr="article_title" axis="col3" class="">
                        <div style="text-align: center; width: 120px;" class="">订单号</div>
                    </th>
                    <th align="left" abbr="ac_id" axis="col4" class="">
                        <div style="text-align: center; width: 130px;" class="">客户</div>
                    </th>

                    <th align="center" abbr="article_time" axis="col6" class="">
                        <div style="text-align: center; width: 50px;" class="">借款金额</div>
                    </th>
                    <th align="center" abbr="article_time" axis="col6" class="">
                        <div style="text-align: center; width: 50px;" class="">借款期限</div>
                    </th>
                    <th align="center" abbr="article_time" axis="col6" class="">
                        <div style="text-align: center; width: 120px;" class="">创建日期</div>
                    </th>
                    <th align="center" abbr="article_time" axis="col6" class="">
                        <div style="text-align: center; width: 100px;" class="">状态</div>
                    </th>
                    <!--th align="center" abbr="article_time" axis="col6" class="">
                     <div style="text-align: center; width: 50px;" class="">提现密码</div>
                   </th-->
                    <th align="center" abbr="article_time" axis="col6" class="">
                        <div style="text-align: center; width: 50px;" class="">转账截图</div>
                    </th>
                    <th align="center" abbr="article_time" axis="col6" class="">
                        <div style="text-align: center; width: 120px;" class="">保单截图</div>
                    </th>
                    <th align="center" axis="col1" class="handle">
                        <div style="text-align: center; width: 100px;">操作</div>
                    </th>
                    <th style="width:100%" axis="col7">
                        <div></div>
                    </th>
                </tr>
                </thead>
            </table>
        </div>
    </div>
    <div class="bDiv" style="height: auto;">
        <div id="flexigrid" cellpadding="0" cellspacing="0" border="0">
            <table style="word-wrap:break-word; word-break:break-all;">
                <tbody>
                <volist name="list" id="vo">
                    <tr style="height: 60px;">
                        <td align="center">
                            <div style="text-align: center; width: 20px;" class="">{$vo.id}</div>
                        </td>
                        <td align="center">
                            <div style="text-align: center; width: 120px;" class="">{$vo.ordernum}</div>
                        </td>
                        <td align="center">
                            <div style="text-align: center; width: 130px;" class="">{$data[$vo['user']]}({$vo.user})
                            </div>
                        </td>

                        <td align="center">
                            <div style="text-align: center; width: 50px;" class="">{$vo.money}元</div>
                        </td>
                        <td align="center">
                            <div style="text-align: center; width: 50px;" class="">{$vo.months}个月</div>
                        </td>
                        <td align="center">
                            <div style="text-align: center; width: 120px;" class="">{$vo.addtime|date='Y-m-d
                                H:i:s',###}
                            </div>
                        </td>
                        <td align="center" style="color:red;">
                            <div style="text-align: center; width: 100px;" class="">
                                <php>
                                    if($vo['status'] == 9)echo "正在审核";
                                    if($vo['status'] == 2)echo "审核通过";
                                    if($vo['status'] == 3)echo "提现已提交,打款处理中";
                                    if($vo['status'] == 4)echo "首期";
                                    if($vo['status'] == -1)echo "审核不通过";
                                    if($vo['status'] == -2)echo "临时冻结";
                                    if($vo['status'] == 5)echo "退款中";
                                    if($vo['status'] == 7)echo "打款中";
                                    if($vo['status'] == 11)echo "提现处理";
                                    if($vo['status'] == 12)echo "到帐成功";
                                    if($vo['status'] == 13)echo "保险";
                                    if($vo['status'] == 14)echo "第一期还款";
                                    if($vo['status'] == 15)echo "提现失败";
                                    if($vo['status'] == 18)echo "征信不良";
                                    if($vo['status'] == 17)echo "核实失败";
                                    if($vo['status'] == 8)echo "绑卡失败";

                                </php>
                            </div>
                        </td>
                        <!--td align="center" style="text-align: center; width: 100px;"><div style="text-align: center; width: 50px;" class="">{$vo.foward}</div></td-->
                        <td align="center" style="text-align: center; width: 100px;">
                            <a href="{:U(GROUP_NAME.'/Daikuan/transferImg',array('id' => $vo['id']))}" class="btn blue"
                               style="margin-top: 8px;"><i class="fa fa-pencil-square-o"></i>转账截图</a>
                        </td>
                        <td align="center" style="text-align: center; width: 100px;">
                            <a href="{:U(GROUP_NAME.'/Daikuan/policyImg',array('id' => $vo['id']))}" class="btn blue" style="margin-top: 8px;"> <i class="fa fa-pencil-square-o"></i>保单截图</a>
                        </td>
                        <td align="center" class="handle" style="width: 100%;">
                            <div style="text-align: left; width: 500px;">
                                <a href="javascript:changestatus('{$vo.ordernum}','{$vo.id}');" class="btn blue"><i
                                        class="fa fa-pencil-square-o"></i>修改订单状态</a>
                                <!--a href="javascript:foward('{$vo.ordernum}','{$vo.id}');" class="btn blue"><i class="fa fa-pencil-square-o"></i>修改提现密码</a-->
                                <a href="javascript:showbank('{$vo.bank}','{$vo.banknum}');" class="btn blue"><i
                                        class="fa fa-list-alt"></i>查看打款信息</a>
                                <a href="{:U(GROUP_NAME.'/User/userinfo',array('user' => $vo['user']))}"
                                   class="btn blue"><i class="fa fa-list-alt"></i>查看资料</a>
                                <a href="{:U(GROUP_NAME.'/User/hetong',array('phone' => $vo['user']))}"
                                   class="btn blue"><i class="fa fa-list-alt"></i>查看合同</a><br/>
                                <a href="javascript:changemoney('{$vo.ordernum}','{$vo.id}','{$vo.money}','{$vo.months}');"
                                   class="btn blue"><i class="fa fa-pencil-square-o"></i>修改金额</a>
                                <a href="javascript:changebank('{$vo.user}','{$vo.id}','{$vo.bank}','{$vo.banknum}');"
                                   class="btn blue"><i class="fa fa-pencil-square-o"></i>
                                    <if condition="$vo['is_bank'] eq 0">
                                        修改银行卡
                                        <else/>
                                        修改银行卡(已修)
                                    </if>
                                </a>

                                <if condition="$vo['yzpz_img'] neq ''">
                                    <a href="javascript:yzpz('{$vo.ordernum}','{$vo.id}','{$vo.yzpz_img}','{$vo.status}');"
                                       style="color:red;" class="btn blue"><i class="fa fa-list-alt"></i>查看凭证</a>
                                </if>
                                <a class="btn red"
                                   href="javascript:del('{$vo.ordernum}','{:U(GROUP_NAME.'/Daikuan/del',array('id'=>$vo['id']))}');"><i
                                        class="fa fa-trash-o"></i>删除</a>

                            </div>
                        </td>
                    </tr>
                </volist>
                </tbody>
            </table>
        </div>
    </div>
</div>
<br/>
<!--分页位置-->
<div class="pages">
    {$page}
</div>
<script type="text/javascript" src="__PUBLIC__/static/js/laydate/laydate.js"></script>
<script>
    laydate.render({
        elem: '#start_time',
        type: 'datetime'
    });
    laydate.render({
        elem: '#end_time',
        type: 'datetime'
    });

    function changeqb(uid) {
        layer.prompt({title: '输入金额，并确认', formType: 0}, function (pass, index) {
            if (pass == '' || pass == null) {
                layer.msg('金额不能为空!');
            } else {
                $.post(
                    "{:U(GROUP_NAME.'/Daikuan/changeqb')}",
                    {id: uid, pass: pass},
                    function (data, state) {
                        if (state != "success") {
                            layer.msg("网络通讯失败!");
                        } else if (data.status == 1) {
                            layer.msg("修改成功!");
                            layer.close(index);
                            location.href = window.location.href;
                        } else {
                            layer.msg(data.msg);
                        }
                    }
                );
            }
        });
    }

    function yzpz(ordernum, oid, imgs, status) {
        $("#yzpz_span").html(ordernum);
        $("#yzpz_orderid").val(oid);
        $("#yzpz_img").attr('src', imgs);
        if (status != 14) {
            $("#yzpzinput").remove();
            $("#yzpz1input").remove();
        }
        layer.open({
            type: 1,
            skin: 'layui-layer-lan', //加上边框
            area: ['580px', '580px'], //宽高
            title: '支付凭证',
            content: $("#yzpz_div").html()
        });
    }

    function del(num, jumpurl) {
        layer.confirm(
            '确定要删除借款订单:' + num + '吗?',
            function () {
                window.location.href = jumpurl;
            }
        );
    }

    function showbank(bankname, banknum) {
        layer.alert(
            '打款银行:' + bankname + "<br>" + '银行卡号:' + banknum,
            {
                skin: 'layui-layer-lan',
                closeBtn: 0,
                anim: 4
            }
        );
    }

    function changestatus(ordernum, oid) {
        $("#changestatus_span").html(ordernum);
        $("#orderid").val(oid);
        layer.open({
            type: 1,
            skin: 'layui-layer-lan', //加上边框
            area: ['580px', '240px'], //宽高
            title: '修改状态',
            content: $("#changestatus_div")
        });
    }

    function foward(ordernum, oid) {
        $("#changestatus_spans").html(ordernum);
        $("#orderid3").val(oid);
        layer.open({
            type: 1,
            skin: 'layui-layer-lan', //加上边框
            area: ['580px', '240px'], //宽高
            title: '修改提现密码',
            content: $("#foward_div")
        });
    }

    function changemoney(ordernum, oid, money, months) {
        $("#changemoney_span").html(ordernum);
        $("#moneyid").val(oid);
        $("#jkje").val(money);
        $("#jksj").val(months);
        layer.open({
            type: 1,
            skin: 'layui-layer-rim', //加上边框
            area: ['580px', '250px'], //宽高
            content: $("#changemoney_div")
        });
    }

    //修改银行卡号
    function changebank(user, oid, bank, banknum) {
        $("#changeb").html(user);
        $("#bankid").val(oid);
        $("#jkje1").val(bank);
        $("#jksj1").val(banknum);
        layer.open({
            type: 1,
            title: '修改卡号',
            skin: 'layui-layer-rim', //加上边框
            area: ['580px', '200px'], //宽高
            content: $("#changebank_div")
        });
    }


    function savestatus() {
        var id = $("#orderid").val();
        var msg = '确定要变更订单状态吗?';
        var status = $('input:radio[name="status"]:checked').val();
        if (status == 11) {
            msg = '变更为提现处理时,客户前台需要输入授权码进入提现阶段!';
        }
        if (status == 12) {
            msg = '变更为打款成功时,说明款项已经打给客户,系统将自动生成分期还款列表,可到未结清列表中查看!';
        }

        if (status != 'undefined' && status != '' && status != null) {
            layer.confirm(
                msg,
                function () {
                    $.post(
                        "{:U(GROUP_NAME.'/Daikuan/changestatus')}",
                        {id: id, status: status},
                        function (data, state) {
                            if (state != "success") {
                                layer.msg("请求数据失败!");
                            } else if (data.status == 1 || data.success == false) {
                                layer.msg("变更状态成功!");
                                setTimeout(function () {
                                    window.location.href = window.location.href;
                                }, 2000);
                            } else {
                                layer.msg(data.msg);
                            }
                        }
                    );

                }
            );
        } else {
            layer.msg("请选择订单状态!");
        }

    }

    function hiddenOrShow(obj) {
        if (obj.value == yjh2) {
            $('.hidden_msg').css("display", "");

            console.log($('#hidden_msg'));
        } else {
            $('.hidden_msg').css("display", "none");
        }
    }

    //保存卡号
    function savebank() {
        var id = $("#bankid").val();
        var bank = $("#jkje1").val();
        var banknum = $("#jksj1").val();
        if (!id) {
            layer.msg("参数id获取错误!");
        }
        var msg = '确定修改吗?';

        if (bank != 'undefined' && bank != '' && banknum != null && banknum != '') {
            layer.confirm(
                msg,
                function () {
                    $.post(
                        "{:U(GROUP_NAME.'/Daikuan/savebanks')}",
                        {id: id, bank: bank, banknum: banknum},
                        function (data, state) {
                            if (state != "success") {
                                layer.msg("请求数据失败!");
                            } else if (data.status == 1 || data.success == false) {
                                layer.msg("修改成功!");
                                setTimeout(function () {
                                    window.location.href = window.location.href;
                                }, 2000);
                            } else {
                                layer.msg(data.msg);
                            }
                        }
                    );

                }
            );
        } else {
            layer.msg("请选择订单状态!");
        }

    }

    function savefoward() {
        var id = $("#orderid3").val();
        var foward = $("#foward").val();
        if (!id) {
            layer.msg("参数获取错误!");
        }
        if (foward != 'undefined' && foward != '' && foward != null) {
            $.post(
                "{:U(GROUP_NAME.'/Daikuan/savefoward')}",
                {id: id, foward: foward},
                function (data, state) {
                    if (state != "success") {
                        layer.msg("请求数据失败!");
                    } else if (data.status == 1) {
                        layer.msg("保存成功!");
                        setTimeout(function () {
                            window.location.href = window.location.href;
                        }, 2000);
                    } else {
                        layer.msg(data.msg);
                    }
                }
            );
        } else {
            layer.msg("请填写提款密码!");
        }
    }

    function savemoney() {
        var id = $("#moneyid").val();
        var money = $("#jkje").val();
        var months = $("#jksj").val();
        if (!id) {
            layer.msg("参数id获取错误!");
        }
        if (money != 'undefined' && money != '' && money != null && months != 'undefined' && months != '' && months != null) {
            $.post(
                "{:U(GROUP_NAME.'/Daikuan/savemoney')}",
                {id: id, money: money, months: months},
                function (data, state) {
                    if (state != "success") {
                        layer.msg("请求数据失败!");
                    } else if (data.status == 1) {
                        layer.msg("保存成功!");
                        setTimeout(function () {
                            window.location.href = window.location.href;
                        }, 2000);
                    } else {
                        layer.msg(data.msg);
                    }
                }
            );
        } else {
            layer.msg("参数获取错误!");
        }
    }

    function yzpzdz(type) {
        var id = $("#yzpz_orderid").val();
        var status = '15';
        var msg = '确定要变更为到账状态吗?';
        if (type == 2) {
            var status = '17';
            var msg = '确定要变更为核实错误状态吗?';
        }
        layer.confirm(
            msg,
            function () {
                $.post(
                    "{:U(GROUP_NAME.'/Daikuan/changestatus')}",
                    {id: id, status: status},
                    function (data, state) {
                        if (state != "success") {
                            layer.msg("请求数据失败!");
                        } else if (data.status == 1 || data.success == false) {
                            layer.msg("变更成功!");
                            setTimeout(function () {
                                window.location.href = window.location.href;
                            }, 2000);
                        } else {
                            layer.msg(data.msg);
                        }
                    }
                );
            }
        );
    }
</script>
<div style="display: none;" id="yzpz_div">
    <table width="100%" border="0" cellpadding="8" cellspacing="0" class="tableBasic">
        <tr>
            <td width="100" align="right">订单号:</td>
            <td>
                <span id="yzpz_span"></span>
                <input type="hidden" id="yzpz_orderid" value=""/>
            </td>
        </tr>
        <tr>
            <td align="right">凭证图:</td>
            <td>
                <label>
                    <img src="" id="yzpz_img" width='500' height="400">
                </label>

            </td>
        </tr>

        <tr>
            <td></td>
            <td>
                <input type="submit" onclick="yzpzdz(1);" class="btn" value="验证成功" id="yzpzinput"/>
                <input type="submit" onclick="yzpzdz(2);" class="btn" value="核实错误" id="yzpz1input"/>
            </td>
        </tr>
    </table>
</div>
<div style="display: none;" id="changemoney_div">
    <table width="100%" border="0" cellpadding="8" cellspacing="0" class="tableBasic">
        <tr>
            <td width="100" align="right">订单号</td>
            <td>
                <span id="changemoney_span"></span>
                <input type="hidden" id="moneyid" value=""/>
            </td>
        </tr>
        <tr>
            <td align="right">借款金额</td>
            <td>
                <label>
                    <input type="text" id="jkje" name="money2" value="" style="border:1px solid;border-radius:2px;">(无需修改请勿提交，否则金额为0)
                </label>
            </td>
        </tr>
        <tr>
            <td align="right">借款时间</td>
            <td>
                <label>
                    <input type="text" id="jksj" name="months" value="" style="border:1px solid;border-radius:2px;">(无需修改请勿提交，否则金额为0)
                </label>
            </td>
        </tr>
        <tr>
            <td></td>
            <td>
                <input type="submit" onclick="savemoney();" class="btn" value="提交"/>
            </td>
        </tr>
    </table>
</div>
<!-- //银行卡号 -->
<div style="display: none;" id="changebank_div">
    <table width="100%" border="0" cellpadding="8" cellspacing="0" class="tableBasic">
        <tr>
            <td width="100" align="right">用户</td>
            <td>
                <span id="changeb"></span>
                <input type="hidden" id="bankid" value=""/>
            </td>
        </tr>
        <tr>
            <td align="right">银行</td>
            <td>
                <label>
                    <input type="text" id="jkje1" name="bank" value="" style="border:1px solid;border-radius:2px;">
                </label>
            </td>
        </tr>
        <tr>
            <td align="right">银行卡号</td>
            <td>
                <label>
                    <input type="text" id="jksj1" name="banknum" value="" style="border:1px solid;border-radius:2px;">
                </label>
            </td>
        </tr>
        <tr>
            <td></td>
            <td>
                <input type="submit" onclick="savebank();" class="btn" value="提交"/>
            </td>
        </tr>
    </table>
</div>
<!-- //银行卡号 -->

<div style="display: none;" id="changestatus_div">
    <table width="100%" border="0" cellpadding="8" cellspacing="0" class="tableBasic">
        <tr>
            <td width="100" align="right">订单号</td>
            <td>
                <span id="changestatus_span"></span>
                <input type="hidden" id="orderid" value=""/>
            </td>
        </tr>
        <tr>
            <td align="right">状态</td>
            <td>
                <label style="color: red;">
                    <input type="radio" name="status" value="2" onchange="hiddenOrShow(this)">
                    审核通过
                </label>
                <label style="color: red;">
                    <input type="radio" name="status" value="-1" onchange="hiddenOrShow(this)">
                    审核不通过
                </label>

                <br/>

                <label style="color: red;">
                    <input type="radio" name="status" value="-2" onchange="hiddenOrShow(this)">
                    冻结
                </label>
                <label style="color: red;">
                    <input type="radio" name="status" value="5" onchange="hiddenOrShow(this)">
                    退款中
                </label>
                <label style="color: red;">
                    <input type="radio" name="status" value="15" onchange="hiddenOrShow(this)">
                    提现失败
                </label>


                <label style="color: red;">
                    <input type="radio" name="status" value="12" onchange="hiddenOrShow(this)">
                    到帐成功
                </label>


                <label style="color: red;">
                    <input type="radio" name="status" value="8" onchange="hiddenOrShow(this)">
                    绑卡失败
                </label>

            </td>
        </tr>
        <tr>
            <td></td>
            <td>
                <input type="submit" onclick="savestatus();" class="btn" value="提交"/>
            </td>
        </tr>
    </table>
</div>
<div style="display: none;" id="foward_div">
    <table width="100%" border="0" cellpadding="8" cellspacing="0" class="tableBasic">
        <tr>
            <td width="100" align="right">订单号</td>
            <td>
                <span id="changestatus_spans"></span>
                <input type="hidden" id="orderid3" value=""/>
            </td>
        </tr>

        <tr class="hidden_msg">
            <td align="right">提现密码</td>
            <td>
                <input id="foward" name="foward" type="text" class="textArea">
            </td>
        </tr>
        <tr>
            <td></td>
            <td>
                <input type="submit" onclick="savefoward();" class="btn" value="提交"/>
            </td>
        </tr>
    </table>
</div>
<style>
    body{
        overflow-y:scroll;
        overflow-x:scroll;
    }
</style>